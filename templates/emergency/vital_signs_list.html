{% extends 'base.html' %}
{% block title %}Signos Vitales - {{ admission.admission_number }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-activity"></i> Signos Vitales - {{ admission.admission_number }}</h2>
        <div>
            <a href="{% url 'emergency:vital_signs_chart' admission.id %}" class="btn btn-info">
                <i class="bi bi-graph-up"></i> Ver Gráfica
            </a>
            <a href="{% url 'emergency:vital_signs_create' admission.id %}" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Nuevo Registro
            </a>
            <a href="{% url 'emergency:admission_detail' admission.id %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>

    <!-- Información del Paciente -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>Paciente:</strong> {{ admission.patient.third_party.name }}
                </div>
                <div class="col-md-4">
                    <strong>Historia Clínica:</strong> {{ admission.patient.medical_record_number }}
                </div>
                <div class="col-md-4">
                    <strong>Estado:</strong> {{ admission.get_status_display }}
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline de Signos Vitales -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-clock-history"></i> Historial de Signos Vitales</h5>
        </div>
        <div class="card-body">
            {% if vital_signs %}
            <div class="table-responsive">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Fecha/Hora</th>
                            <th>PA (mmHg)</th>
                            <th>FC (lpm)</th>
                            <th>FR (rpm)</th>
                            <th>Temp (°C)</th>
                            <th>O2 (%)</th>
                            <th>Dolor (0-10)</th>
                            <th>Peso (kg)</th>
                            <th>Talla (cm)</th>
                            <th>Glasgow</th>
                            <th>Registrado por</th>
                            <th>Observaciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vs in vital_signs %}
                        <tr>
                            <td><strong>{{ vs.recorded_datetime|date:"d/m/Y H:i" }}</strong></td>
                            <td>
                                {% if vs.blood_pressure_systolic %}
                                    {{ vs.blood_pressure_systolic }}/{{ vs.blood_pressure_diastolic }}
                                    {% if vs.blood_pressure_systolic >= 140 or vs.blood_pressure_systolic <= 90 %}
                                    <i class="bi bi-exclamation-triangle text-warning" title="Valor anormal"></i>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if vs.heart_rate %}
                                    {{ vs.heart_rate }}
                                    {% if vs.heart_rate > 100 or vs.heart_rate < 60 %}
                                    <i class="bi bi-exclamation-triangle text-warning" title="Valor anormal"></i>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if vs.respiratory_rate %}
                                    {{ vs.respiratory_rate }}
                                    {% if vs.respiratory_rate > 20 or vs.respiratory_rate < 12 %}
                                    <i class="bi bi-exclamation-triangle text-warning" title="Valor anormal"></i>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if vs.temperature %}
                                    {{ vs.temperature }}
                                    {% if vs.temperature >= 38 or vs.temperature <= 35 %}
                                    <i class="bi bi-exclamation-triangle text-warning" title="Valor anormal"></i>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if vs.oxygen_saturation %}
                                    {{ vs.oxygen_saturation }}%
                                    {% if vs.oxygen_saturation < 92 %}
                                    <i class="bi bi-exclamation-triangle text-danger" title="Hipoxemia"></i>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if vs.pain_scale %}
                                    <span class="badge {% if vs.pain_scale >= 7 %}bg-danger{% elif vs.pain_scale >= 4 %}bg-warning{% else %}bg-success{% endif %}">
                                        {{ vs.pain_scale }}/10
                                    </span>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>{% if vs.weight %}{{ vs.weight }}{% else %}<span class="text-muted">-</span>{% endif %}</td>
                            <td>{% if vs.height %}{{ vs.height }}{% else %}<span class="text-muted">-</span>{% endif %}</td>
                            <td>
                                {% if vs.glasgow_score %}
                                    <span class="badge {% if vs.glasgow_score <= 8 %}bg-danger{% elif vs.glasgow_score <= 12 %}bg-warning{% else %}bg-success{% endif %}">
                                        {{ vs.glasgow_score }}/15
                                    </span>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td><small>{{ vs.recorded_by.get_full_name }}</small></td>
                            <td>
                                {% if vs.observations %}
                                <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="{{ vs.observations }}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Leyenda -->
            <div class="alert alert-info mt-3">
                <strong>Leyenda:</strong>
                <i class="bi bi-exclamation-triangle text-warning"></i> Valor fuera de rango normal |
                <i class="bi bi-exclamation-triangle text-danger"></i> Valor crítico
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-activity text-muted" style="font-size: 4rem;"></i>
                <p class="text-muted mt-3">No hay signos vitales registrados para esta admisión.</p>
                <a href="{% url 'emergency:vital_signs_create' admission.id %}" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Registrar Primer Registro
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Inicializar tooltips de Bootstrap
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
});
</script>
{% endblock %}
